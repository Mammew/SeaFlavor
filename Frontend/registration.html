<!DOCTYPE html>
<html lang="en">    
<head>
    <title>UNICORN PROJECT</title>
    <link rel="stylesheet" type="text/css" href="registration.css">
</head>
<body>
    <form id="form" action="../Backend/registration.php" method="post"><br>
        <h2 id="under_title">Sign In</h2>
        <div>
            <label class="label" for="firstname_field">Nome:</label><br>
            <input type="text" name="firstname_field" id="firstname_field" required>
        </div> 

        <div>
            <label class="label" for="lastname_field">Cognome:</label><br>
            <input type="text" name="lastname_field" id="lastname_field" required>
        </div> 

        <div>
            <label class="label" for="email_field">Email:</label><br>
            <input type="email" name="email_field" id="email_field" required>
            <div class="err-message" id="email_error"></div>
        </div>         
        
        <div>
            <label class="label" for="password_field">Password:</label><br>
            <input type="password" name="password_field" id="password_field" required>
        </div>
        <input type="submit" id="submit" name="submit" value="Sign-up">
    </form>
</body>
    <script>
        let email_error = document.getElementById("email_error");
        let mail = document.getElementById("email_field");
        mail.addEventListener("change",function checkmail(){
            let usermail = mail.value;
            let url = "../Backend/checkMail.php";
            return fetch(url,{
                method: "post",
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: "email_field=" + usermail
            }).then(function(response){
                if(response.status != 200){
                    console.log("there was a problem...");
                    return;
                }
                return response;
            })  
            .then((response) => response.text())
            .then(text => {
                if (text == "0") {
                    email_error.innerHTML = " ";
                }
                else if(text == "1")
                    email_error.innerHTML = "email already used, try one different";
                })
            })
    </script>
</html>